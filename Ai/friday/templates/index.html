<html>

<head>
    {% load static %}
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="{% static '1.css' %}">
    <link rel="icon" href="{% static 'battery-charge.png' %}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <script>
        function getLocation() {

            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    const latitude = position.coords.latitude;
                    const longitude = position.coords.longitude;

                    // Call a function to get weather data using latitude and longitude
                    getWeather(latitude, longitude);
                }, function (error) {
                    console.error("Error getting location:", error);
                });
            } else {
                console.error("Geolocation is not available in this browser.");
            }
        }

        // Function to get weather data and display it
        function getWeather(latitude, longitude) {

            const apiUrl = `https://api.openweathermap.org/data/2.5/weather?lat=${latitude}&lon=${longitude}&appid=7c71a62cf9e14093284fabb4d78facfb&units=metric`;

            const settings = {
                async: true,
                crossDomain: true,
                url: apiUrl,
                method: 'GET'
            };

            // Make the API request using jQuery
            $.ajax(settings).done(function (response) {
                console.log(response);
                // Handle the weather data here, e.g., display it on the page
                const temperature = response.main.temp;
                const weatherDescription = response.weather[0].description;

                const wind = response.wind.deg;
                const speed = response.wind.speed;
                document.getElementById("weather").innerHTML = `Temperature : ${temperature}Â°C, ${weatherDescription}`;
                // readOut(`The current temperature is ${temperature} degrees Celsius with ${weatherDescription}.Wind speed is ${speed} meters per second, coming from the ${wind} degrees..`);
            }).fail(function (error) {
                console.error("Error:", error);
            });
        }

        // Call the function to get location and weather data
        getLocation();

    </script>


</head>

<body>
    <!-- Left Menu -->
    <div id="leftmenu">

        <div id="date_time">
            <div id="date" class="semi_arc e4">
                <div class="semi_arc_2 e4_1">
                    <div class="counterspin4"></div>
                </div>
                <div style="font-size: 35px; margin-top: 35px;" id="currentDate"></div>
                <div style="font-size: 20px;" id="currentMonth"></div>
            </div>

            <div id="time" class="arc e1">
                <div style="font-size: 28px; margin-left: -3px; margin-top: 35px;" id="time1"></div>
            </div>

        </div>

        <br>

        <div id="weather1">
            <div style="font-size: 20px; margin-top: 35px;" id="weather"></div>
        </div>

        <br><br><br><br>
        <br><br><br>

        <p class="title">Shortcuts</p>
        <div class="hline title_underline"></div>

        <div class="menu">
            <a href="https://www.instagram.com/" target="_blank"><button class="menuitem"> <span
                        class="entypo-right-open" />
                    <p class="caption">Instagram</p>
                </button></a>
            <a href="https://www.youtube.com/" target="_blank"><button class="menuitem"> <span
                        class="entypo-right-open" />
                    <p class="caption">YouTube</p>
                </button></a>
            <a href="https://www.hotstar.com/in/home?ref=%2Fin" target="_blank"><button class="menuitem"> <span
                        class="entypo-right-open" />
                    <p class="caption">Hotstar</p>
                </button></a>
            <a href="https://www.netflix.com/in/" target="_blank"><button class="menuitem"> <span
                        class="entypo-right-open" />
                    <p class="caption">Netflix</p>
                </button></a>

            <hr style="border-color: transparent; margin: 0;" />
            <div class="hline" style="margin-top: 5px; margin-bottom: 5px;"></div>

            <a href="https://mscit.glsmoodle.in/" target="_blank"><button class="menuitem"> <span
                        class="entypo-right-open" />
                    <p class="caption">Moodle</p>
                </button></a>
            <a href="https://github.com/whitedevil4511" target="_blank"><button class="menuitem"> <span
                        class="entypo-right-open" />
                    <p class="caption">GitHub</p>
                </button></a>
            <a href="https://www.udemy.com/" target="_blank"><button class="menuitem"> <span
                        class="entypo-right-open" />
                    <p class="caption">Udemy</p>
                </button></a>
        </div>
    </div>

    <div class="jarvis-interface">
        <div class="jarvis-content">
            <div class="voice-recognition">
                <div id="listeningStatus"></div>
            </div>
            <div class="output">
                <p class="voiceInput" id="voiceInput">Welcome, Sir. How can I assist you today?</p>
                <input type="hidden" id="voiceInputField" value="voiceInput" />
                <p class="voiceInput" id="voiceoutput"></p>
            </div>
        </div>
    </div>

    <!-- Right Menu -->
    <div id="rightmenu">

        <div id="battery1" class="arc e1">
            <div style="font-size: 20px; margin-left: -3px; margin-top: 35px;" id="battery"></div>
        </div>

        <br><br><br>

        <p class="title">Information</p><br>
        <div class="hline title_underline"></div>

        <span class="menuitem entypo-network" style="font-size: 20px; margin-left: 10px;">
            <p class="caption" style="font-size: 20px;" id="ipAddress"></p>
        </span> <br />

        <span class="menuitem entypo-monitor" style="font-size: 20px; margin-left: 10px;">
            <p class="caption" style="font-size: 20px;" id="browserName"></p>
        </span> <br />

        <span class="menuitem entypo-qq" style="font-size: 20px; margin-left: 10px;">
            <p class="caption" style="font-size: 20px;" id="browserVersion"></p>
        </span>

        <br><br><br>
        <br><br><br>
        <br><br><br>
        <br><br>

        <p class="title" style="text-align: left; margin-left: 10px;">Reminder</p>
        <div id="particle10" class="hline"></div>
        <div id="particle11" class="hline"></div>
        <div id="particle12" class="vline"></div>
        <textarea rows="15" cols="44" id="note_input">To Complete:
                - Weather
                - Performance
                - Date/Time
                - Battery
            </textarea>
    </div>

    <!-- Arc Reactor -->
    <div id="arc_container">
        <div class="arc_reactor">
            <div class="case_container">
                <div class="e7">
                    <div class="semi_arc_3 e5_1">
                        <div class="semi_arc_3 e5_2">
                            <div class="semi_arc_3 e5_3">
                                <div class="semi_arc_3 e5_4"></div>
                            </div>
                        </div>
                    </div>
                    <div class="core2"></div>
                </div>
                <ul class="marks">
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Particles -->
    <!-- Left Menu Particles -->
    <canvas id="particle1" width="20" height="500"></canvas>
    <script>
        var canvas = document.getElementById('particle1');
        var context = canvas.getContext('2d');

        context.beginPath();
        context.moveTo(0, 0);
        context.lineTo(0, 70);
        context.lineTo(10, 85);
        context.lineTo(10, 135);
        context.lineTo(0, 150);
        context.lineTo(0, 480);
        context.lineTo(5, 490);
        context.lineTo(10, 490);
        context.lineTo(20, 490);
        context.lineTo(20, 250);
        context.lineTo(10, 235);
        context.lineTo(10, 185);
        context.lineTo(20, 170);
        context.lineTo(20, 40);
        context.lineTo(10, 30);
        context.lineTo(10, 20);

        context.closePath();
        context.lineWidth = 1;
        context.fillStyle = 'rgba(2,254,255,0.3)';
        context.fill();
        context.strokeStyle = 'transparent';
        context.stroke();
    </script>

    <canvas id="particle1_1" width="40" height="510"></canvas>
    <script>
        var canvas = document.getElementById('particle1_1');
        var context = canvas.getContext('2d');

        context.beginPath();
        context.lineTo(0, 0);
        context.lineTo(10, 15);
        context.lineTo(10, 65);
        context.lineTo(0, 80);
        context.lineTo(0, 0);

        context.closePath();
        context.lineWidth = 1;
        context.fillStyle = 'rgba(2,254,255,0.3)';
        context.fill();
        context.strokeStyle = 'transparent';
        context.stroke();
    </script>

    <canvas id="particle1_2" width="40" height="510"></canvas>

    <script>
        var canvas = document.getElementById('particle1_2');
        var context = canvas.getContext('2d');

        context.beginPath();
        context.lineTo(10, 80);
        context.lineTo(0, 65);
        context.lineTo(0, 15);
        context.lineTo(10, 0);
        context.lineTo(10, 80);

        context.closePath();
        context.lineWidth = 1;
        context.fillStyle = 'rgba(2,254,255,0.3)';
        context.fill();
        context.strokeStyle = 'transparent';
        context.stroke();
    </script>

    <script>
        // chargeing
        let charge, currentTime
        let batteryPromise = navigator.getBattery();
        batteryPromise.then(batteryCallback);

        function batteryCallback(batteryObject) {
            printBatteryStatus(batteryObject);
            setInterval(() => {
                printBatteryStatus(batteryObject);
            }, 5000);
        }
        function printBatteryStatus(batteryObject) {
            document.querySelector("#battery").textContent = `${(batteryObject.level * 100).toFixed(2)
                }%`;
            charge = batteryObject.level * 100
        }

        let date = new Date();
        let hrs = date.getHours();
        let mins = date.getMinutes();
        let secs = date.getSeconds();

        const time = document.querySelector("#time1");

        function formatAMPM(date) {
            var hours = date.getHours();
            var minutes = date.getMinutes();
            var ampm = hours >= 12 ? 'pm' : 'am';
            hours = hours % 12;
            hours = hours ? hours : 12; // the hour '0' should be '12'
            minutes = minutes < 10 ? '0' + minutes : minutes;
            var strTime = hours + ':' + minutes;
            currentTime = strTime
            time.textContent = strTime
        }

        formatAMPM(date)
        setInterval(() => {
            formatAMPM(date)
        }, 60000);



        // Function to update the date and day
        function updateDateAndDay() {
            var currentDate = new Date();

            var date = currentDate.getDate();

            var monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

            var monthName = monthNames[currentDate.getMonth()];

            document.getElementById("currentDate").textContent = date;
            document.getElementById("currentMonth").textContent = monthName;
        }

        updateDateAndDay();


        // getBrowserDetails
        function getBrowserDetails() {
            const userAgent = window.navigator.userAgent;
            const browserName = getBrowserName(userAgent);
            const browserVersion = getBrowserVersion(userAgent);

            document.getElementById("browserName").textContent = `Browser Name: ${browserName}`;
            document.getElementById("browserVersion").textContent = `Browser Version: ${browserVersion}`;
        }

        function getBrowserName(userAgent) {
            if (userAgent.includes("Chrome")) return "Google Chrome";
            if (userAgent.includes("Firefox")) return "Mozilla Firefox";
            if (userAgent.includes("Safari")) return "Apple Safari";
            if (userAgent.includes("Edge")) return "Microsoft Edge";
            if (userAgent.includes("Opera")) return "Opera";
            return "Unknown";
        }

        function getBrowserVersion(userAgent) {
            const match = userAgent.match(/(Chrome|Firefox|Safari|Edge|Opera)\/(\S+)/);
            if (match) return match[2];
            return "Unknown";
        }

        getBrowserDetails();


        // Ip Address
        async function getPublicIPAddress() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                const ipAddress = data.ip;
                document.getElementById("ipAddress").textContent = `IP Address: ${ipAddress}`;
            } catch (error) {
                console.error('Error fetching IP address:', error);
                document.getElementById("ipAddress").textContent = 'Unable to retrieve IP address.';
            }
        }

        // Call the function to fetch and display the IP address
        getPublicIPAddress();



        // Voice Input
        const voiceInputField = document.getElementById('voiceInputField');
        const listeningStatus = document.getElementById('listeningStatus');
        const voiceInputParagraph = document.getElementById('voiceInput');
        const output = document.getElementById('voiceoutput');


        // Function to show the "Listening" status
        function showListeningStatus() {
            listeningStatus.style.display = 'block';
            listeningStatus.innerHTML = "Listening...";
        }

        // Function to hide the "Listening" status
        function hideListeningStatus() {
            listeningStatus.innerHTML = "Voice Assistant Inactive";
        }

        function readOut(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            speechSynthesis.speak(utterance);
        }

        // Create a function to send voice input to the server

        const sendVoiceInputToServer = (voiceInput) => {
            fetch('/process_voice_input/', {
                method: 'POST',
                body: JSON.stringify({ voiceInput }),
                headers: {
                    'Content-Type': 'application/json'
                }
            })
                .then(response => response.json())
                .then(data => {
                    // Handle the response from the server if needed
                    voiceInputParagraph.textContent = voiceInput;
                    output.textContent = data.message;
                    readOut(data.message);

                    if (data.url) {
                        window.open(data.url, '_blank');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        };

        // Use the SpeechRecognition API to capture voice input
        const recognition = new webkitSpeechRecognition() || new SpeechRecognition();
        recognition.continuous = true;

        recognition.onstart = showListeningStatus;
        recognition.onend = hideListeningStatus;

        recognition.onresult = function (event) {
            const result = event.results[event.results.length - 1];
            if (result.isFinal) {
                const voiceInputValue = result[0].transcript;
                voiceInputField.value = voiceInputValue;
                sendVoiceInputToServer(voiceInputValue); // Send voice input to the server
            }
        };

        // Start listening when the page loads
        document.addEventListener("DOMContentLoaded", () => {
            recognition.start();
            hideListeningStatus(); // Initially hide the status
        });


    </script>
</body>

</html>